<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Viral Content Predictor</title>

  <!-- React + Babel (no npm needed) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      min-height: 100vh;
      padding: 2rem 1rem;
    }

    /* â”€â”€ layout â”€â”€ */
    .page { max-width: 720px; margin: 0 auto; }

    .header { text-align: center; margin-bottom: 2rem; }
    .header h1 { font-size: 1.9rem; font-weight: 700; color: #f0f6fc; }
    .header p  { color: #8b949e; font-size: 0.92rem; margin-top: 0.4rem; line-height: 1.55; }

    .warning {
      background: rgba(210,153,34,0.12);
      border: 1px solid rgba(210,153,34,0.5);
      border-radius: 10px;
      padding: 0.85rem 1.1rem;
      font-size: 0.83rem;
      color: #d2993a;
      margin-bottom: 1.6rem;
      line-height: 1.55;
    }
    .warning strong { color: #e3a73f; }

    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 14px;
      padding: 1.6rem;
      margin-bottom: 1.4rem;
    }
    .card-title {
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #8b949e;
      margin-bottom: 1.1rem;
    }

    /* â”€â”€ grid â”€â”€ */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }
    @media (max-width: 540px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
    }

    /* â”€â”€ form controls â”€â”€ */
    .field { display: flex; flex-direction: column; gap: 0.35rem; }
    .field label { font-size: 0.82rem; color: #8b949e; font-weight: 500; }

    select, input[type="datetime-local"], input[type="text"] {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      color: #e6edf3;
      font-size: 0.9rem;
      padding: 0.55rem 0.75rem;
      width: 100%;
      outline: none;
      transition: border-color .15s;
      -webkit-appearance: none;
      appearance: none;
    }
    select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238b949e' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 0.75rem center; padding-right: 2rem; }
    select:focus, input:focus { border-color: #58a6ff; }
    select option { background: #161b22; }

    /* â”€â”€ slider â”€â”€ */
    .slider-wrap { display: flex; align-items: center; gap: 0.75rem; }
    input[type="range"] {
      flex: 1; -webkit-appearance: none; appearance: none;
      height: 5px; border-radius: 3px;
      background: linear-gradient(to right, #f85149 0%, #8b949e 50%, #3fb950 100%);
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 16px; height: 16px; border-radius: 50%;
      background: #e6edf3; cursor: pointer;
      box-shadow: 0 0 0 3px rgba(88,166,255,.3);
    }
    .slider-value {
      min-width: 3rem; text-align: right;
      font-size: 0.9rem; font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    .slider-labels {
      display: flex; justify-content: space-between;
      font-size: 0.72rem; color: #8b949e; margin-top: 0.2rem;
    }

    /* â”€â”€ hashtag chips â”€â”€ */
    .hashtag-preview {
      display: flex; flex-wrap: wrap; gap: 0.35rem; margin-top: 0.5rem; min-height: 1.6rem;
    }
    .chip {
      background: rgba(56,139,253,0.15); border: 1px solid rgba(56,139,253,0.4);
      color: #58a6ff; border-radius: 999px;
      font-size: 0.76rem; padding: 0.15rem 0.6rem;
    }

    /* â”€â”€ button â”€â”€ */
    .btn-predict {
      width: 100%; padding: 0.85rem;
      border: none; border-radius: 10px; cursor: pointer;
      font-size: 1rem; font-weight: 700;
      background: linear-gradient(135deg, #238636, #2ea043);
      color: #fff;
      box-shadow: 0 4px 20px rgba(46,160,67,.35);
      transition: filter .15s, transform .1s;
    }
    .btn-predict:hover:not(:disabled) { filter: brightness(1.12); transform: translateY(-1px); }
    .btn-predict:disabled {
      background: #21262d; color: #8b949e;
      box-shadow: none; cursor: default; transform: none;
    }

    /* â”€â”€ result â”€â”€ */
    .result { border-radius: 14px; padding: 1.5rem; text-align: center; margin-top: 1.4rem; }
    .result.viral    { background: rgba(46,160,67,.12); border: 2px solid rgba(46,160,67,.55); }
    .result.noviral  { background: rgba(248,81,73,.1);  border: 2px solid rgba(248,81,73,.45); }
    .result .emoji   { font-size: 2.5rem; line-height: 1; }
    .result .verdict { font-size: 1.6rem; font-weight: 800; margin: 0.4rem 0 0.2rem; }
    .result.viral   .verdict { color: #3fb950; }
    .result.noviral .verdict { color: #f85149; }
    .result .conf   { font-size: 0.88rem; color: #8b949e; }

    .bar-bg {
      background: #21262d; border-radius: 999px;
      height: 10px; margin-top: 1rem; overflow: hidden;
    }
    .bar-fill {
      height: 100%; border-radius: 999px;
      transition: width .6s ease;
    }
    .bar-fill.viral   { background: linear-gradient(90deg, #238636, #3fb950); }
    .bar-fill.noviral { background: linear-gradient(90deg, #b91c1c, #f85149); }

    .error {
      background: rgba(248,81,73,.1); border: 1px solid rgba(248,81,73,.4);
      border-radius: 10px; padding: 0.8rem 1rem;
      font-size: 0.85rem; color: #ff7b72; margin-top: 1rem;
    }

    .footer { text-align: center; color: #484f58; font-size: 0.78rem; margin-top: 2rem; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const API = "http://localhost:8000";

    const PLATFORMS     = ["Instagram", "TikTok", "X", "YouTube Shorts"];
    const CONTENT_TYPES = ["carousel", "image", "text", "video"];
    const TOPICS        = ["Education", "Entertainment", "Lifestyle", "Politics", "Sports", "Technology"];
    const LANGUAGES     = ["en", "es", "fr", "hi", "ur"];
    const REGIONS       = ["Brazil", "India", "Pakistan", "UK", "US"];

    function now() {
      const d = new Date();
      const pad = n => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function SelectField({ label, value, onChange, options }) {
      return (
        <div className="field">
          <label>{label}</label>
          <select value={value} onChange={e => onChange(e.target.value)}>
            {options.map(o => <option key={o} value={o}>{o}</option>)}
          </select>
        </div>
      );
    }

    function App() {
      const [form, setForm] = React.useState({
        platform:        "Instagram",
        content_type:    "video",
        topic:           "Entertainment",
        language:        "es",
        region:          "US",
        post_datetime:   now(),
        hashtags:        "#viral #trending #fyp",
        sentiment_score: 0.5,
      });

      const [result,  setResult]  = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error,   setError]   = React.useState(null);

      const set = (key) => (val) => setForm(f => ({ ...f, [key]: val }));

      const hashtags = form.hashtags.match(/#\w+/g) || [];

      const sentimentLabel = (v) => {
        if (v >= 0.5)  return { text: "Muy positivo", color: "#3fb950" };
        if (v >= 0.1)  return { text: "Positivo",     color: "#56d364" };
        if (v > -0.1)  return { text: "Neutro",        color: "#8b949e" };
        if (v > -0.5)  return { text: "Negativo",      color: "#f0883e" };
        return               { text: "Muy negativo",   color: "#f85149" };
      };
      const sl = sentimentLabel(form.sentiment_score);

      async function handlePredict() {
        setLoading(true);
        setError(null);
        setResult(null);
        try {
          const dt = form.post_datetime.replace("T", " ") + ":00";
          const body = { ...form, post_datetime: dt };
          const res = await fetch(`${API}/predict-viral`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          });
          if (!res.ok) {
            const err = await res.json();
            throw new Error(err.detail || `HTTP ${res.status}`);
          }
          setResult(await res.json());
        } catch (e) {
          setError(e.message || "No se pudo conectar al API. Asegurate de que el backend este corriendo.");
        } finally {
          setLoading(false);
        }
      }

      return (
        <div className="page">
          <div className="header">
            <h1>Viral Content Predictor</h1>
            <p>
              Predice si tu contenido se hara viral usando solo informacion
              disponible <strong>antes de publicar</strong>.
            </p>
          </div>

          <div className="warning">
            <strong>Nota sobre el modelo:</strong> El modelo original
            usaba <code>views</code>, <code>likes</code>, <code>comments</code> y
            <code>shares</code> â€” datos que solo existen despues de publicar,
            lo que lo hace inutilizable para prediccion real. Este predictor usa
            un modelo re-entrenado con features validas: plataforma, tema,
            hashtags, hora, sentimiento del texto y region. Accuracy en test: ~67%
            (realista para prediccion pre-publicacion).
          </div>

          {/* Plataforma y tipo */}
          <div className="card">
            <div className="card-title">Configuracion del post</div>
            <div className="grid-3" style={{ marginBottom: "1rem" }}>
              <SelectField label="Plataforma"    value={form.platform}     onChange={set("platform")}     options={PLATFORMS} />
              <SelectField label="Tipo de contenido" value={form.content_type} onChange={set("content_type")} options={CONTENT_TYPES} />
              <SelectField label="Tema"          value={form.topic}        onChange={set("topic")}        options={TOPICS} />
            </div>
            <div className="grid-2">
              <SelectField label="Idioma"  value={form.language} onChange={set("language")} options={LANGUAGES} />
              <SelectField label="Region"  value={form.region}   onChange={set("region")}   options={REGIONS} />
            </div>
          </div>

          {/* Fecha/hora */}
          <div className="card">
            <div className="card-title">Fecha y hora de publicacion</div>
            <div className="field">
              <label>Cuando vas a publicar?</label>
              <input
                type="datetime-local"
                value={form.post_datetime}
                onChange={e => set("post_datetime")(e.target.value)}
              />
            </div>
            <p style={{ fontSize: "0.78rem", color: "#484f58", marginTop: "0.5rem" }}>
              El modelo extrae la hora del dia y el dia de la semana como seÃ±ales de timing.
            </p>
          </div>

          {/* Hashtags */}
          <div className="card">
            <div className="card-title">Hashtags</div>
            <div className="field">
              <label>Escribe tus hashtags (separados por espacio)</label>
              <input
                type="text"
                placeholder="#viral #trending #fyp"
                value={form.hashtags}
                onChange={e => set("hashtags")(e.target.value)}
              />
            </div>
            <div className="hashtag-preview">
              {hashtags.length === 0
                ? <span style={{ fontSize:"0.78rem", color:"#484f58" }}>Ninguno detectado</span>
                : hashtags.map(h => <span key={h} className="chip">{h}</span>)
              }
            </div>
            <p style={{ fontSize: "0.78rem", color: "#484f58", marginTop: "0.55rem" }}>
              {hashtags.length} hashtag{hashtags.length !== 1 ? "s" : ""} detectado{hashtags.length !== 1 ? "s" : ""}
            </p>
          </div>

          {/* Sentimiento */}
          <div className="card">
            <div className="card-title">Sentimiento del contenido</div>
            <p style={{ fontSize:"0.82rem", color:"#8b949e", marginBottom:"0.8rem" }}>
              Que tan positivo o negativo es el mensaje principal de tu post?
            </p>
            <div className="slider-wrap">
              <span style={{ fontSize:"0.8rem", color:"#f85149" }}>Negativo</span>
              <input
                type="range" min="-1" max="1" step="0.05"
                value={form.sentiment_score}
                onChange={e => set("sentiment_score")(parseFloat(e.target.value))}
              />
              <span style={{ fontSize:"0.8rem", color:"#3fb950" }}>Positivo</span>
              <span className="slider-value" style={{ color: sl.color }}>
                {form.sentiment_score > 0 ? "+" : ""}{form.sentiment_score.toFixed(2)}
              </span>
            </div>
            <div className="slider-labels">
              <span>-1.0</span><span>-0.5</span><span>0</span><span>+0.5</span><span>+1.0</span>
            </div>
            <p style={{ fontSize:"0.82rem", marginTop:"0.5rem", color: sl.color, fontWeight:600 }}>
              {sl.text}
            </p>
          </div>

          {/* Boton */}
          <button
            className="btn-predict"
            onClick={handlePredict}
            disabled={loading}
          >
            {loading ? "Analizando..." : "Predecir viralidad"}
          </button>

          {/* Error */}
          {error && (
            <div className="error">
              <strong>Error:</strong> {error}
              <br /><br />
              Asegurate de que el backend este corriendo:<br />
              <code>python api.py</code>
            </div>
          )}

          {/* Resultado */}
          {result && (
            <div className={`result ${result.is_viral ? "viral" : "noviral"}`}>
              <div className="emoji">{result.is_viral ? "ðŸ”¥" : "ðŸ“‰"}</div>
              <div className="verdict">{result.label}</div>
              <div className="conf">
                Probabilidad de volverse viral: <strong>{result.confidence_pct}</strong>
              </div>
              <div className="bar-bg">
                <div
                  className={`bar-fill ${result.is_viral ? "viral" : "noviral"}`}
                  style={{ width: `${(result.confidence * 100).toFixed(1)}%` }}
                />
              </div>
              <p style={{ marginTop:"1rem", fontSize:"0.8rem", color:"#8b949e" }}>
                Plataforma: <strong>{result.inputs_used.platform}</strong> &nbsp;|&nbsp;
                Tipo: <strong>{result.inputs_used.content_type}</strong> &nbsp;|&nbsp;
                Tema: <strong>{result.inputs_used.topic}</strong>
              </p>
            </div>
          )}

          <div className="footer">
            Modelo: Gradient Boosting &nbsp;|&nbsp;
            Features pre-publicacion &nbsp;|&nbsp;
            Backend: FastAPI localhost:8000
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
